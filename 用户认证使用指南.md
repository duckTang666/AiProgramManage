# AI项目管理平台 - 用户认证使用指南

## 概述

本系统使用Supabase作为后端数据库服务，实现了完整的用户认证功能，包括邮箱密码登录、用户注册、会话管理和权限控制。

## 功能特性

### 🔐 用户认证
- **邮箱密码登录**：使用邮箱和密码进行安全登录
- **用户注册**：新用户注册功能，支持邮箱验证
- **会话管理**：自动管理用户会话，支持持久化登录
- **权限控制**：基于角色的访问控制（RBAC）

### 🛡️ 安全特性
- 密码加密存储
- 邮箱验证流程
- 会话安全管理
- 行级安全策略（RLS）

## 快速开始

### 1. 数据库初始化

在开始使用前，需要先初始化Supabase数据库：

1. **登录Supabase控制台**
   - 访问：https://supabase.com/dashboard/project/pgnjxsvtxrqsuukadlzu
   - 使用项目凭据登录

2. **执行数据库初始化脚本**
   - 在SQL编辑器中执行 `supabase-init.sql` 文件内容
   - 此脚本会创建所有必要的数据库表和索引

3. **插入测试数据（可选）**
   - 执行 `supabase-mock-data.sql` 文件内容
   - 包含测试用户、组织、项目等数据

### 2. 环境配置

确保 `.env` 文件包含正确的Supabase配置：

```env
VITE_SUPABASE_URL=https://pgnjxsvtxrqsuukadlzu.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnbmp4c3Z0eHJxc3V1a2FkbHp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2MTQ5NjYsImV4cCI6MjA3NzE5MDk2Nn0.kw0yn1Wnn4GzkXbPYRUcTjyQr6esb-BED5h-OdFiEMI
```

### 3. 测试数据库连接

访问 `/database-test` 页面验证数据库连接状态：

1. 检查环境变量配置
2. 测试Supabase认证连接
3. 验证数据库表结构
4. 查看详细的测试结果

## 用户认证流程

### 注册流程

1. **访问注册页面** (`/register`)
   - 填写姓名、邮箱、密码、确认密码
   - 密码要求：至少6位字符

2. **邮箱验证**
   - 系统会发送验证邮件到注册邮箱
   - 点击邮件中的链接完成验证

3. **注册成功**
   - 自动跳转到登录页面
   - 可以使用注册的邮箱密码登录

### 登录流程

1. **访问登录页面** (`/login`)
   - 输入注册时使用的邮箱和密码

2. **认证验证**
   - 系统验证邮箱密码是否正确
   - 检查用户状态是否激活

3. **登录成功**
   - 自动跳转到仪表板页面
   - 建立用户会话

### 会话管理

- **自动登录**：支持"记住我"功能
- **会话持久化**：浏览器关闭后仍保持登录状态
- **安全退出**：支持手动退出登录

## 测试账号

系统提供以下测试账号用于快速体验：

| 邮箱 | 密码 | 角色 | 权限 |
|------|------|------|------|
| admin@aipm.com | 任意密码 | 管理员 | 完整权限 |
| manager@aipm.com | 任意密码 | 项目经理 | 项目管理权限 |
| developer@aipm.com | 任意密码 | 开发工程师 | 开发相关权限 |

## 错误处理

### 常见错误及解决方案

#### 登录错误
- **"邮箱或密码错误"**：检查邮箱密码是否正确
- **"请先验证您的邮箱地址"**：需要先完成邮箱验证
- **"用户不存在"**：邮箱未注册，请先注册

#### 注册错误
- **"该邮箱已被注册"**：邮箱已被使用，请使用其他邮箱
- **"密码强度不足"**：密码需要包含字母、数字和特殊字符
- **"两次输入的密码不一致"**：确认密码与密码不匹配

#### 数据库连接错误
- **"Supabase配置不完整"**：检查环境变量配置
- **"数据库连接失败"**：检查网络连接和Supabase服务状态
- **"表不存在"**：需要先执行数据库初始化脚本

## 技术架构

### 前端技术栈
- **Vue 3**：现代化前端框架
- **TypeScript**：类型安全的JavaScript
- **Pinia**：状态管理库
- **Vue Router**：路由管理
- **Tailwind CSS**：样式框架

### 后端服务
- **Supabase**：BaaS（后端即服务）平台
- **PostgreSQL**：关系型数据库
- **Row Level Security**：行级安全策略
- **Auth**：认证服务

### 安全特性
- **JWT Token**：基于令牌的认证
- **密码哈希**：使用bcrypt加密存储
- **会话管理**：安全的会话处理
- **CORS配置**：跨域资源共享安全设置

## 开发指南

### 添加新的认证功能

1. **扩展认证存储** (`src/stores/auth.ts`)
```typescript
// 添加新的认证方法
async function resetPassword(email: string) {
  const { error } = await supabase.auth.resetPasswordForEmail(email)
  if (error) throw error
}
```

2. **创建认证页面**
- 参考 `src/views/Login.vue` 和 `src/views/Register.vue`
- 使用认证存储进行状态管理

3. **更新路由配置** (`src/router/index.ts`)
- 添加新的路由路径
- 配置路由守卫

### 自定义认证逻辑

1. **用户角色管理**
```typescript
// 检查用户角色
const userRole = computed(() => authStore.user?.user_metadata?.role)
```

2. **权限控制**
```typescript
// 路由守卫中的权限检查
if (to.meta.requiresAdmin && userRole !== 'admin') {
  next('/unauthorized')
}
```

## 故障排除

### 常见问题

**Q: 登录后页面不跳转？**
A: 检查路由守卫配置和认证状态初始化

**Q: 注册后收不到验证邮件？**
A: 检查Supabase的邮箱服务配置和垃圾邮件文件夹

**Q: 数据库连接测试失败？**
A: 验证环境变量配置和网络连接

**Q: 表结构检查显示"未创建"？**
A: 需要先执行数据库初始化SQL脚本

### 调试工具

1. **浏览器开发者工具**
   - 查看网络请求
   - 检查控制台错误信息

2. **Supabase控制台**
   - 查看认证日志
   - 监控数据库查询

3. **数据库测试页面**
   - 访问 `/database-test`
   - 查看详细的连接状态和错误信息

## 安全建议

1. **生产环境配置**
   - 使用强密码策略
   - 启用双因素认证
   - 配置HTTPS加密

2. **数据保护**
   - 定期备份数据库
   - 监控异常登录行为
   - 实施访问日志记录

3. **代码安全**
   - 避免硬编码敏感信息
   - 使用环境变量管理配置
   - 定期更新依赖包

## 支持与反馈

如遇到问题或需要帮助，请：

1. 查看本使用指南
2. 访问数据库测试页面检查连接状态
3. 检查浏览器控制台错误信息
4. 联系开发团队获取技术支持

---

*最后更新：2025-10-28*