const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dhaj8LKV.js","assets/vue-B0LylYIL.js","assets/supabase-DqT9qdmq.js","assets/index-DjfOomyX.css"])))=>i.map(i=>d[i]);
import{_ as Z}from"./supabase-DqT9qdmq.js";import{a as tt,r as c,C as A,k as et,b as l,f as e,e as f,l as st,y as nt,p as ot,G as $,F as at,h as it,D as M,w as j,v as E,t as a,z as R,A as lt,o as r,n as rt}from"./vue-B0LylYIL.js";import{u as dt,a as ct}from"./index-Dhaj8LKV.js";const ut={class:"min-h-screen"},mt={class:"bg-white shadow-sm border-b border-gray-200"},vt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},pt={class:"flex justify-between h-16"},gt={class:"flex items-center"},ft={class:"flex items-center space-x-4"},xt={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},bt={class:"px-4 py-6 sm:px-0"},yt={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},_t={class:"flex items-start justify-between mb-4"},wt=["onClick"],ht={class:"flex items-center space-x-2"},kt={class:"relative"},zt=["onClick"],Ct={key:0,class:"absolute right-0 mt-1 w-32 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-10"},Ot={class:"py-1"},Dt=["onClick"],Ut=["onClick"],$t=["onClick"],jt={class:"text-gray-600 text-sm mb-4"},Et={class:"grid grid-cols-2 gap-3 mb-4"},Mt={class:"text-center"},Rt={class:"text-lg font-semibold text-blue-600"},It={class:"text-center"},St={class:"text-lg font-semibold text-green-600"},Vt={class:"border-t pt-3"},Lt={class:"text-xs text-gray-500 space-y-1"},Nt={class:"flex justify-between"},At={class:"flex justify-between"},Bt={key:1,class:"text-center py-12"},Tt={class:"mt-6"},Ht={key:2,class:"text-center py-12"},qt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Ft={class:"bg-white rounded-lg max-w-md w-full p-6"},Pt={class:"space-y-4"},Gt={key:0,class:"text-red-600 text-sm mt-2"},Wt={class:"flex justify-end space-x-3 mt-6"},Jt=["disabled"],Kt={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Qt={class:"bg-white rounded-lg max-w-md w-full p-6"},Xt={class:"space-y-4"},Yt={key:0,class:"text-red-600 text-sm mt-2"},Zt={class:"flex justify-end space-x-3 mt-6"},te=["disabled"],ee={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},se={class:"bg-white rounded-lg max-w-md w-full p-6"},ne={class:"text-gray-600 mb-6"},oe={key:0,class:"text-red-600 text-sm mt-2"},ae={class:"flex justify-end space-x-3"},ie=["disabled"],le=5*60*1e3,me=tt({__name:"Organizations",setup(re){const I=lt(),u=dt(),i=ct(),{organizations:S,isLoading:V}=i,b=c(!1),w=c(!1),h=c(!1),k=c(!1),z=c(!1),C=c(!1),p=c(""),x=c(""),y=c(""),v=c(null),m=A({name:"",description:""}),d=A({id:0,name:"",description:""}),O=c(null);function L(s){return new Date(s).toLocaleDateString("zh-CN")}function B(s){I.push(`/organizations/${s}`)}async function T(){try{await u.logout(),I.push("/login")}catch(s){console.error("Logout error:",s)}}function H(s){v.value===s?v.value=null:v.value=s}document.addEventListener("click",()=>{v.value=null});function q(s){v.value=null,d.id=s.id,d.name=s.name,d.description=s.description||"",w.value=!0,x.value=""}async function F(){if(!d.name.trim()){x.value="è¯·è¾“å…¥ç»„ç»‡åç§°";return}z.value=!0,x.value="";try{await i.updateOrganization(d.id,{name:d.name,description:d.description}),console.log("âœ… ç»„ç»‡æ›´æ–°æˆåŠŸ"),w.value=!1;const s=u.user?.id;if(s){const t=await U(s);t?.id&&await i.fetchOrganizations(t.id)}}catch(s){console.error("âŒ æ›´æ–°ç»„ç»‡å¤±è´¥:",s),x.value=s.message||"æ›´æ–°ç»„ç»‡å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"}finally{z.value=!1}}async function P(s){v.value=null;try{await i.updateOrganization(s.id,{is_active:!s.is_active}),console.log("âœ… ç»„ç»‡çŠ¶æ€æ›´æ–°æˆåŠŸ");const t=u.user?.id;if(t){const o=await U(t);o?.id&&await i.fetchOrganizations(o.id)}}catch(t){console.error("âŒ æ›´æ–°ç»„ç»‡çŠ¶æ€å¤±è´¥:",t),alert("æ›´æ–°ç»„ç»‡çŠ¶æ€å¤±è´¥: "+(t.message||"æœªçŸ¥é”™è¯¯"))}}function G(s){v.value=null,O.value=s,h.value=!0,y.value=""}async function W(){if(O.value){C.value=!0,y.value="";try{await i.deleteOrganization(O.value.id),console.log("âœ… ç»„ç»‡åˆ é™¤æˆåŠŸ"),h.value=!1;const s=u.user?.id;if(s){const t=await U(s);t?.id&&await i.fetchOrganizations(t.id)}}catch(s){console.error("âŒ åˆ é™¤ç»„ç»‡å¤±è´¥:",s),y.value=s.message||"åˆ é™¤ç»„ç»‡å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"}finally{C.value=!1}}}async function J(){if(!m.name.trim()){p.value="è¯·è¾“å…¥ç»„ç»‡åç§°";return}k.value=!0,p.value="";try{console.log("ğŸ“ å¼€å§‹åˆ›å»ºç»„ç»‡æµç¨‹...");const s=125;console.log("ğŸ‘¤ ç›´æ¥ä½¿ç”¨æ•°æ®åº“ç”¨æˆ·ID:",s);const t=await i.createOrganization({name:m.name,description:m.description,owner_id:s});console.log("âœ… ç»„ç»‡åˆ›å»ºæˆåŠŸ:",t),b.value=!1,m.name="",m.description="",await i.fetchOrganizations(s),console.log("ğŸ”„ ç»„ç»‡æ•°æ®é‡æ–°åŠ è½½å®Œæˆ")}catch(s){console.error("âŒ åˆ›å»ºç»„ç»‡å¤±è´¥:",s),s.message?.includes("foreign key constraint")?p.value="åˆ›å»ºç»„ç»‡å¤±è´¥ï¼šç”¨æˆ·ID 125ä¸å­˜åœ¨æˆ–å¤–é”®çº¦æŸå¤±è´¥ã€‚è¯·ç¡®ä¿æ•°æ®åº“ä¸­å­˜åœ¨IDä¸º125çš„ç”¨æˆ·ã€‚":s.message?.includes("duplicate key")?p.value="åˆ›å»ºç»„ç»‡å¤±è´¥ï¼šç»„ç»‡åç§°å·²å­˜åœ¨ã€‚è¯·ä½¿ç”¨ä¸åŒçš„åç§°ã€‚":p.value=s.message||"åˆ›å»ºç»„ç»‡å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æ•°æ®åº“çŠ¶æ€"}finally{k.value=!1}}et(async()=>{await K()});async function K(){try{console.log("ğŸ” å¼€å§‹åŠ è½½ç»„ç»‡æ•°æ®..."),console.log("ğŸ‘¤ ç›´æ¥ä½¿ç”¨æ•°æ®åº“ç”¨æˆ·ID 125"),await i.fetchOrganizations(125),console.log("âœ… ç»„ç»‡æ•°æ®åŠ è½½å®Œæˆï¼Œæ•°é‡:",i.organizations.length),i.organizations.length===0&&console.log("ğŸ“ ç”¨æˆ·æš‚æ— ç»„ç»‡ï¼Œæ˜¾ç¤ºåˆ›å»ºæç¤º")}catch(s){console.error("âŒ åŠ è½½ç»„ç»‡æ•°æ®å¤±è´¥:",s),console.log("ğŸ”„ å°è¯•ä½¿ç”¨è®¤è¯ç”¨æˆ·IDä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ");const t=u.user?.id;if(t)try{const o=await U(t);o&&o.id&&await i.fetchOrganizations(o.id)}catch(o){console.error("âŒ å¤‡ç”¨æ–¹æ¡ˆä¹Ÿå¤±è´¥:",o)}}}let _=null,D=0;async function U(s){const t=Date.now();if(_&&t-D<le)return console.log("ğŸ“¦ ä½¿ç”¨ç¼“å­˜çš„ç”¨æˆ·è®°å½•"),_;try{const{UserService:o}=await Z(async()=>{const{UserService:X}=await import("./index-Dhaj8LKV.js").then(Y=>Y.d);return{UserService:X}},__vite__mapDeps([0,1,2,3])),n=await o.getUserByAuthId(s);if(n)return _=n,D=t,n;console.log("ç”¨æˆ·è®°å½•ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»ºç”¨æˆ·è®°å½•");const g=u.user?.email||`user_${Date.now()}@example.com`,Q=u.user?.user_metadata?.name||g.split("@")[0]||"ç”¨æˆ·",N=await o.createUser({auth_id:s,email:g,display_name:Q,role:"member",is_active:!0});return _=N,D=t,N}catch(o){console.error("è·å–ç”¨æˆ·è®°å½•å¤±è´¥:",o);const n={id:Date.now(),email:u.user?.email||`user_${Date.now()}@example.com`,display_name:u.user?.user_metadata?.name||"ç”¨æˆ·",role:"member",is_active:!0};return _=n,D=t,n}}return(s,t)=>{const o=ot("RouterLink");return r(),l("div",ut,[e("nav",mt,[e("div",vt,[e("div",pt,[e("div",gt,[st(o,{to:"/",class:"text-gray-600 hover:text-gray-900"},{default:nt(()=>[...t[9]||(t[9]=[R(" â† è¿”å›å·¥ä½œå° ",-1)])]),_:1})]),e("div",ft,[e("button",{onClick:t[0]||(t[0]=n=>b.value=!0),class:"btn btn-primary"}," åˆ›å»ºç»„ç»‡ "),e("button",{onClick:T,class:"btn btn-outline text-sm"}," é€€å‡ºç™»å½• ")])])])]),e("main",xt,[e("div",bt,[t[19]||(t[19]=e("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"ç»„ç»‡ç®¡ç†",-1)),!$(V)&&$(S).length>0?(r(),l("div",yt,[(r(!0),l(at,null,it($(S),n=>(r(),l("div",{key:n.id,class:"card p-6 hover:shadow-md transition-shadow"},[e("div",_t,[e("h3",{class:"text-lg font-semibold text-gray-900 cursor-pointer",onClick:g=>B(n.id)},a(n.name),9,wt),e("div",ht,[e("span",{class:rt([n.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800","px-2 py-1 rounded-full text-xs"])},a(n.is_active?"æ´»è·ƒ":"å·²åœç”¨"),3),e("div",kt,[e("button",{onClick:M(g=>H(n.id),["stop"]),class:"p-1 text-gray-400 hover:text-gray-600 rounded"},[...t[10]||(t[10]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})],-1)])],8,zt),v.value===n.id?(r(),l("div",Ct,[e("div",Ot,[e("button",{onClick:g=>q(n),class:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," ç¼–è¾‘ç»„ç»‡ ",8,Dt),e("button",{onClick:g=>P(n),class:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},a(n.is_active?"åœç”¨ç»„ç»‡":"æ¿€æ´»ç»„ç»‡"),9,Ut),e("button",{onClick:g=>G(n),class:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100"}," åˆ é™¤ç»„ç»‡ ",8,$t)])])):f("",!0)])])]),e("p",jt,a(n.description||"æš‚æ— æè¿°"),1),e("div",Et,[e("div",Mt,[e("div",Rt,a(n.project_count||0),1),t[11]||(t[11]=e("div",{class:"text-xs text-gray-500"},"é¡¹ç›®æ•°",-1))]),e("div",It,[e("div",St,a(n.member_count||1),1),t[12]||(t[12]=e("div",{class:"text-xs text-gray-500"},"æˆå‘˜æ•°",-1))])]),e("div",Vt,[e("div",Lt,[e("div",Nt,[t[13]||(t[13]=e("span",null,"åˆ›å»ºæ—¶é—´:",-1)),e("span",null,a(L(n.created_at)),1)]),e("div",At,[t[14]||(t[14]=e("span",null,"æ›´æ–°æ—¶é—´:",-1)),e("span",null,a(n.updated_at?L(n.updated_at):"--"),1)])])])]))),128))])):$(V)?(r(),l("div",Ht,[...t[18]||(t[18]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"},null,-1),e("p",{class:"mt-2 text-sm text-gray-600"},"åŠ è½½ä¸­...",-1)])])):(r(),l("div",Bt,[t[15]||(t[15]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-2m2 0v-2m0 2v2M7 21h2m-2 0H5m2 0v-2m0 2v2"})],-1)),t[16]||(t[16]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"æš‚æ— ç»„ç»‡",-1)),t[17]||(t[17]=e("p",{class:"mt-1 text-sm text-gray-500"},"åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªç»„ç»‡å¼€å§‹ç®¡ç†é¡¹ç›®",-1)),e("div",Tt,[e("button",{onClick:t[1]||(t[1]=n=>b.value=!0),class:"btn btn-primary"}," åˆ›å»ºç»„ç»‡ ")])]))])]),b.value?(r(),l("div",qt,[e("div",Ft,[t[22]||(t[22]=e("h3",{class:"text-lg font-semibold mb-4"},"åˆ›å»ºæ–°ç»„ç»‡",-1)),e("form",{onSubmit:M(J,["prevent"])},[e("div",Pt,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ç»„ç»‡åç§°",-1)),j(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>m.name=n),type:"text",required:"",class:"input",placeholder:"è¯·è¾“å…¥ç»„ç»‡åç§°"},null,512),[[E,m.name]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ç»„ç»‡æè¿°",-1)),j(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=n=>m.description=n),class:"input resize-none",rows:"3",placeholder:"è¯·è¾“å…¥ç»„ç»‡æè¿°ï¼ˆå¯é€‰ï¼‰"},null,512),[[E,m.description]])])]),p.value?(r(),l("div",Gt,a(p.value),1)):f("",!0),e("div",Wt,[e("button",{type:"button",onClick:t[4]||(t[4]=n=>b.value=!1),class:"btn btn-secondary"}," å–æ¶ˆ "),e("button",{type:"submit",disabled:k.value,class:"btn btn-primary"},a(k.value?"åˆ›å»ºä¸­...":"åˆ›å»º"),9,Jt)])],32)])])):f("",!0),w.value?(r(),l("div",Kt,[e("div",Qt,[t[25]||(t[25]=e("h3",{class:"text-lg font-semibold mb-4"},"ç¼–è¾‘ç»„ç»‡",-1)),e("form",{onSubmit:M(F,["prevent"])},[e("div",Xt,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ç»„ç»‡åç§°",-1)),j(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>d.name=n),type:"text",required:"",class:"input",placeholder:"è¯·è¾“å…¥ç»„ç»‡åç§°"},null,512),[[E,d.name]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ç»„ç»‡æè¿°",-1)),j(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=n=>d.description=n),class:"input resize-none",rows:"3",placeholder:"è¯·è¾“å…¥ç»„ç»‡æè¿°ï¼ˆå¯é€‰ï¼‰"},null,512),[[E,d.description]])])]),x.value?(r(),l("div",Yt,a(x.value),1)):f("",!0),e("div",Zt,[e("button",{type:"button",onClick:t[7]||(t[7]=n=>w.value=!1),class:"btn btn-secondary"}," å–æ¶ˆ "),e("button",{type:"submit",disabled:z.value,class:"btn btn-primary"},a(z.value?"æ›´æ–°ä¸­...":"æ›´æ–°"),9,te)])],32)])])):f("",!0),h.value?(r(),l("div",ee,[e("div",se,[t[28]||(t[28]=e("h3",{class:"text-lg font-semibold mb-4 text-red-600"},"ç¡®è®¤åˆ é™¤",-1)),e("p",ne,[t[26]||(t[26]=R(' ç¡®å®šè¦åˆ é™¤ç»„ç»‡ "',-1)),e("strong",null,a(O.value?.name),1),t[27]||(t[27]=R('" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯¥ç»„ç»‡ä¸‹çš„æ‰€æœ‰é¡¹ç›®ä¹Ÿå°†è¢«åˆ é™¤ã€‚ ',-1))]),y.value?(r(),l("div",oe,a(y.value),1)):f("",!0),e("div",ae,[e("button",{type:"button",onClick:t[8]||(t[8]=n=>h.value=!1),class:"btn btn-secondary"}," å–æ¶ˆ "),e("button",{onClick:W,disabled:C.value,class:"btn btn-danger"},a(C.value?"åˆ é™¤ä¸­...":"ç¡®è®¤åˆ é™¤"),9,ie)])])])):f("",!0)])}}});export{me as default};
