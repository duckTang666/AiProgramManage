import{a as R,r as i,C as T,k as A,H,b as d,f as e,e as h,l as O,y as F,p as q,t as a,F as G,h as J,E as S,w as C,v as I,D as K,g as Q,z as j,o as u,n as W}from"./vue-CUAfhYnW.js";import{a as X,b as Y,u as Z,U as D}from"./index-DAXvTnSp.js";import"./supabase-DiqIXwZt.js";const ee={class:"min-h-screen"},te={class:"bg-white shadow-sm border-b border-gray-200"},se={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},oe={class:"flex justify-between h-16"},ae={class:"flex items-center space-x-4"},le={class:"text-xl font-semibold text-gray-900"},ne={class:"flex items-center space-x-4"},re={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},ie={class:"px-4 py-6 sm:px-0"},de={class:"card p-6 mb-6"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ce={class:"space-y-3"},me={class:"font-medium"},ve={class:"text-gray-700"},pe={class:"font-medium"},xe={class:"space-y-3"},ge={class:"font-medium"},fe={class:"font-medium"},be={class:"font-medium"},ye={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},we={class:"flex justify-between items-start mb-3"},he=["onClick"],_e=["onClick"],ke=["onClick"],Ce={class:"flex justify-between items-center"},je={class:"text-xs text-gray-500"},De={key:1,class:"text-center py-12"},ze={class:"mt-6"},Se={key:2,class:"text-center py-12"},Ie={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Ue={class:"bg-white rounded-lg max-w-md w-full p-6"},Ve={class:"space-y-4"},Me={key:0,class:"text-red-600 text-sm mt-2"},$e={class:"flex justify-end space-x-3 mt-6"},Be=["disabled"],Pe={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Ee={class:"bg-white rounded-lg max-w-md w-full p-6"},Le={class:"text-gray-600 mb-6"},Ne={class:"font-semibold text-gray-900"},Re={key:0,class:"text-red-600 text-sm mb-4 p-3 bg-red-50 rounded-lg"},Te={class:"flex justify-end space-x-3"},Ae=["disabled"],He=["disabled"],Je=R({__name:"OrganizationDetail",setup(Oe){const _=H(),U=X(),f=Y(),l=Z(),n=i(),c=i([]),b=i(!0),x=i(!1),y=i(!1),w=i(!1),g=i(!1),p=i(""),v=i(""),m=i(null),r=T({name:"",description:"",status:"active"});function k(s){return new Date(s).toLocaleDateString("zh-CN")}function V(s){return{planning:"bg-gray-100 text-gray-800",active:"bg-green-100 text-green-800",completed:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800"}[s]||"bg-gray-100 text-gray-800"}function M(s){return{planning:"è§„åˆ’ä¸­",active:"æ´»è·ƒ",completed:"å·²å®Œæˆ",cancelled:"å·²å–æ¶ˆ"}[s]||s}async function $(){if(!r.name.trim()){p.value="è¯·è¾“å…¥é¡¹ç›®åç§°";return}if(!l.user){p.value="è¯·å…ˆç™»å½•åå†åˆ›å»ºé¡¹ç›®";return}w.value=!0,p.value="";try{const s=await B();await f.createProject({...r,organization_id:parseInt(_.params.id),owner_id:s}),x.value=!1,r.name="",r.description="",r.status="active"}catch(s){p.value=s.message||"åˆ›å»ºé¡¹ç›®å¤±è´¥"}finally{w.value=!1}}async function B(){try{if(!l.user)throw new Error("ç”¨æˆ·æœªç™»å½•");if(l.user.id){const s=await D.getUserByAuthId(l.user.id);if(s)return s.id}if(l.user.email){const s=await D.getUserByEmail(l.user.email);if(s)return s.id}if(l.user.email&&l.user.user_metadata?.name)return console.log("ğŸ“ ç”¨æˆ·è®°å½•ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»ºç”¨æˆ·è®°å½•"),(await D.createUser({auth_id:l.user.id,email:l.user.email,display_name:l.user.user_metadata.name||l.user.email.split("@")[0],role:"member"})).id;throw new Error("ç”¨æˆ·è®°å½•ä¸å­˜åœ¨ï¼Œè¯·å…ˆå®Œå–„ä¸ªäººä¿¡æ¯")}catch(s){throw console.error("è·å–ç”¨æˆ·IDå¤±è´¥:",s),new Error("æ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·é‡æ–°ç™»å½•")}}A(async()=>{const s=parseInt(_.params.id);if(isNaN(s)){console.error("âŒ æ— æ•ˆçš„ç»„ç»‡ID:",_.params.id),b.value=!1;return}try{if(console.log("ğŸ” åŠ è½½ç»„ç»‡è¯¦æƒ…ï¼Œç»„ç»‡ID:",s),n.value=await U.fetchOrganizationById(s),console.log("âœ… ç»„ç»‡ä¿¡æ¯åŠ è½½å®Œæˆ:",n.value),!n.value){console.error("âŒ ç»„ç»‡ä¸å­˜åœ¨ï¼ŒID:",s);return}const t=await f.fetchProjects(s);t.success?(c.value=f.projects,console.log("âœ… é¡¹ç›®åˆ—è¡¨åŠ è½½å®Œæˆï¼Œæ•°é‡:",c.value.length)):(console.error("âŒ åŠ è½½é¡¹ç›®åˆ—è¡¨å¤±è´¥:",t.error),c.value=[])}catch(t){console.error("âŒ åŠ è½½ç»„ç»‡è¯¦æƒ…å¤±è´¥:",t)}finally{b.value=!1}});function P(s){m.value=s,v.value="",y.value=!0}function E(){m.value=null,v.value="",y.value=!1}async function L(){if(m.value){g.value=!0,v.value="";try{const s=await f.deleteProject(m.value.id);s.success?(c.value=c.value.filter(t=>t.id!==m.value.id),console.log("âœ… é¡¹ç›®åˆ é™¤æˆåŠŸ:",m.value.name),y.value=!1,m.value=null):(v.value=s.error||"åˆ é™¤é¡¹ç›®å¤±è´¥",console.error("âŒ åˆ é™¤é¡¹ç›®å¤±è´¥:",s.error))}catch(s){v.value=s.message||"åˆ é™¤é¡¹ç›®æ—¶å‘ç”Ÿé”™è¯¯",console.error("âŒ åˆ é™¤é¡¹ç›®æ—¶å‘ç”Ÿé”™è¯¯:",s)}finally{g.value=!1}}}return(s,t)=>{const N=q("RouterLink");return u(),d("div",ee,[e("nav",te,[e("div",se,[e("div",oe,[e("div",ae,[O(N,{to:"/organizations",class:"text-gray-600 hover:text-gray-900"},{default:F(()=>[...t[6]||(t[6]=[j(" â† è¿”å›ç»„ç»‡åˆ—è¡¨ ",-1)])]),_:1}),e("h1",le,a(n.value?.name),1)]),e("div",ne,[e("button",{onClick:t[0]||(t[0]=o=>x.value=!0),class:"btn btn-primary"}," åˆ›å»ºé¡¹ç›® ")])])])]),e("main",re,[e("div",ie,[e("div",de,[t[15]||(t[15]=e("h2",{class:"text-lg font-semibold mb-4"},"ç»„ç»‡ä¿¡æ¯",-1)),e("div",ue,[e("div",null,[t[10]||(t[10]=e("h3",{class:"text-md font-medium text-gray-900 mb-2"},"åŸºæœ¬ä¿¡æ¯",-1)),e("div",ce,[e("div",null,[t[7]||(t[7]=e("span",{class:"text-sm text-gray-500"},"ç»„ç»‡åç§°:",-1)),e("p",me,a(n.value?.name||"æœªè®¾ç½®"),1)]),e("div",null,[t[8]||(t[8]=e("span",{class:"text-sm text-gray-500"},"ç»„ç»‡æè¿°:",-1)),e("p",ve,a(n.value?.description||"æš‚æ— æè¿°"),1)]),e("div",null,[t[9]||(t[9]=e("span",{class:"text-sm text-gray-500"},"ç»„ç»‡çŠ¶æ€:",-1)),e("p",pe,a(n.value?.is_active?"æ´»è·ƒ":"å·²åœç”¨"),1)])])]),e("div",null,[t[14]||(t[14]=e("h3",{class:"text-md font-medium text-gray-900 mb-2"},"æ—¶é—´ä¿¡æ¯",-1)),e("div",xe,[e("div",null,[t[11]||(t[11]=e("span",{class:"text-sm text-gray-500"},"åˆ›å»ºæ—¶é—´:",-1)),e("p",ge,a(n.value?.created_at?k(n.value.created_at):"æœªè®¾ç½®"),1)]),e("div",null,[t[12]||(t[12]=e("span",{class:"text-sm text-gray-500"},"æ›´æ–°æ—¶é—´:",-1)),e("p",fe,a(n.value?.updated_at?k(n.value.updated_at):"æœªè®¾ç½®"),1)]),e("div",null,[t[13]||(t[13]=e("span",{class:"text-sm text-gray-500"},"é¡¹ç›®æ•°é‡:",-1)),e("p",be,a(c.value.length)+" ä¸ª",1)])])])])]),e("div",null,[t[21]||(t[21]=e("h2",{class:"text-lg font-semibold mb-4"},"é¡¹ç›®åˆ—è¡¨",-1)),!b.value&&c.value.length>0?(u(),d("div",ye,[(u(!0),d(G,null,J(c.value,o=>(u(),d("div",{key:o.id,class:"card p-6 hover:shadow-md transition-shadow"},[e("div",we,[e("h3",{class:"text-lg font-semibold text-gray-900 cursor-pointer flex-1",onClick:z=>s.$router.push(`/projects/${o.id}`)},a(o.name),9,he),e("button",{onClick:S(z=>P(o),["stop"]),class:"p-1 text-gray-400 hover:text-red-600 transition-colors ml-2",title:"åˆ é™¤é¡¹ç›®"},[...t[16]||(t[16]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,_e)]),e("p",{class:"text-gray-600 text-sm mb-4 cursor-pointer",onClick:z=>s.$router.push(`/projects/${o.id}`)},a(o.description||"æš‚æ— æè¿°"),9,ke),e("div",Ce,[e("span",{class:W([V(o.status),"px-2 py-1 rounded-full text-xs"])},a(M(o.status)),3),e("span",je,a(k(o.created_at)),1)])]))),128))])):b.value?(u(),d("div",Se,[...t[20]||(t[20]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"},null,-1),e("p",{class:"mt-2 text-sm text-gray-600"},"åŠ è½½ä¸­...",-1)])])):(u(),d("div",De,[t[17]||(t[17]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t[18]||(t[18]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"æš‚æ— é¡¹ç›®",-1)),t[19]||(t[19]=e("p",{class:"mt-1 text-sm text-gray-500"},"åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªé¡¹ç›®å¼€å§‹å·¥ä½œ",-1)),e("div",ze,[e("button",{onClick:t[1]||(t[1]=o=>x.value=!0),class:"btn btn-primary"}," åˆ›å»ºé¡¹ç›® ")])]))])])]),x.value?(u(),d("div",Ie,[e("div",Ue,[t[26]||(t[26]=e("h3",{class:"text-lg font-semibold mb-4"},"åˆ›å»ºæ–°é¡¹ç›®",-1)),e("form",{onSubmit:S($,["prevent"])},[e("div",Ve,[e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"é¡¹ç›®åç§°",-1)),C(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>r.name=o),type:"text",required:"",class:"input",placeholder:"è¯·è¾“å…¥é¡¹ç›®åç§°"},null,512),[[I,r.name]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"é¡¹ç›®æè¿°",-1)),C(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.description=o),class:"input resize-none",rows:"3",placeholder:"è¯·è¾“å…¥é¡¹ç›®æè¿°ï¼ˆå¯é€‰ï¼‰"},null,512),[[I,r.description]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"é¡¹ç›®çŠ¶æ€",-1)),C(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>r.status=o),class:"input"},[...t[24]||(t[24]=[e("option",{value:"planning"},"è§„åˆ’ä¸­",-1),e("option",{value:"active"},"æ´»è·ƒ",-1),e("option",{value:"completed"},"å·²å®Œæˆ",-1),e("option",{value:"cancelled"},"å·²å–æ¶ˆ",-1)])],512),[[K,r.status]])])]),p.value?(u(),d("div",Me,a(p.value),1)):h("",!0),e("div",$e,[e("button",{type:"button",onClick:t[5]||(t[5]=o=>x.value=!1),class:"btn btn-secondary"}," å–æ¶ˆ "),e("button",{type:"submit",disabled:w.value,class:"btn btn-primary"},a(w.value?"åˆ›å»ºä¸­...":"åˆ›å»º"),9,Be)])],32)])])):h("",!0),y.value?(u(),d("div",Pe,[e("div",Ee,[t[29]||(t[29]=Q('<div class="flex items-center mb-4"><div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-3"><svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div><h3 class="text-lg font-semibold text-gray-900">ç¡®è®¤åˆ é™¤</h3></div>',1)),e("p",Le,[t[27]||(t[27]=j(" ç¡®å®šè¦åˆ é™¤é¡¹ç›® ",-1)),e("span",Ne,'"'+a(m.value?.name)+'"',1),t[28]||(t[28]=j(" å—ï¼Ÿ æ­¤æ“ä½œå°†åˆ é™¤é¡¹ç›®åŠå…¶æ‰€æœ‰å…³è”ä»»åŠ¡ï¼Œä¸”æ— æ³•æ’¤é”€ã€‚ ",-1))]),v.value?(u(),d("div",Re,a(v.value),1)):h("",!0),e("div",Te,[e("button",{type:"button",onClick:E,disabled:g.value,class:"btn btn-secondary"}," å–æ¶ˆ ",8,Ae),e("button",{type:"button",onClick:L,disabled:g.value,class:"btn btn-danger"},a(g.value?"åˆ é™¤ä¸­...":"ç¡®è®¤åˆ é™¤"),9,He)])])])):h("",!0)])}}});export{Je as default};
