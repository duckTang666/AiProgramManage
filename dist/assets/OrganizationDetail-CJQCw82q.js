import{a as U,r as c,C as j,k as V,H as B,b as i,f as t,e as _,l as E,y as N,p as M,t as o,F as P,h as $,D as L,w as b,v as h,E as R,o as d,z as O,n as T}from"./vue-B0LylYIL.js";import{a as A,b as F,u as H,U as w}from"./index-Dhaj8LKV.js";import"./supabase-DqT9qdmq.js";const q={class:"min-h-screen"},G={class:"bg-white shadow-sm border-b border-gray-200"},J={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},K={class:"flex justify-between h-16"},Q={class:"flex items-center space-x-4"},W={class:"text-xl font-semibold text-gray-900"},X={class:"flex items-center space-x-4"},Y={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},Z={class:"px-4 py-6 sm:px-0"},tt={class:"card p-6 mb-6"},et={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},st={class:"space-y-3"},at={class:"font-medium"},ot={class:"text-gray-700"},nt={class:"font-medium"},rt={class:"space-y-3"},lt={class:"font-medium"},it={class:"font-medium"},dt={class:"font-medium"},ut={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},mt=["onClick"],ct={class:"text-lg font-semibold text-gray-900 mb-2"},pt={class:"text-gray-600 text-sm mb-4"},vt={class:"flex justify-between items-center"},xt={class:"text-xs text-gray-500"},gt={key:1,class:"text-center py-12"},ft={class:"mt-6"},yt={key:2,class:"text-center py-12"},bt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},wt={class:"bg-white rounded-lg max-w-md w-full p-6"},_t={class:"space-y-4"},ht={key:0,class:"text-red-600 text-sm mt-2"},kt={class:"flex justify-end space-x-3 mt-6"},Ct=["disabled"],jt=U({__name:"OrganizationDetail",setup(zt){const g=B(),k=A(),f=F(),n=H(),r=c(),u=c([]),v=c(!0),p=c(!1),x=c(!1),m=c(""),l=j({name:"",description:"",status:"active"});function y(s){return new Date(s).toLocaleDateString("zh-CN")}function C(s){return{planning:"bg-gray-100 text-gray-800",active:"bg-green-100 text-green-800",completed:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800"}[s]||"bg-gray-100 text-gray-800"}function z(s){return{planning:"è§„åˆ’ä¸­",active:"æ´»è·ƒ",completed:"å·²å®Œæˆ",cancelled:"å·²å–æ¶ˆ"}[s]||s}async function D(){if(!l.name.trim()){m.value="è¯·è¾“å…¥é¡¹ç›®åç§°";return}if(!n.user){m.value="è¯·å…ˆç™»å½•åå†åˆ›å»ºé¡¹ç›®";return}x.value=!0,m.value="";try{const s=await I();await f.createProject({...l,organization_id:parseInt(g.params.id),owner_id:s}),p.value=!1,l.name="",l.description="",l.status="active"}catch(s){m.value=s.message||"åˆ›å»ºé¡¹ç›®å¤±è´¥"}finally{x.value=!1}}async function I(){try{if(!n.user)throw new Error("ç”¨æˆ·æœªç™»å½•");if(n.user.id){const s=await w.getUserByAuthId(n.user.id);if(s)return s.id}if(n.user.email){const s=await w.getUserByEmail(n.user.email);if(s)return s.id}if(n.user.email&&n.user.user_metadata?.name)return console.log("ğŸ“ ç”¨æˆ·è®°å½•ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»ºç”¨æˆ·è®°å½•"),(await w.createUser({auth_id:n.user.id,email:n.user.email,display_name:n.user.user_metadata.name||n.user.email.split("@")[0],role:"member"})).id;throw new Error("ç”¨æˆ·è®°å½•ä¸å­˜åœ¨ï¼Œè¯·å…ˆå®Œå–„ä¸ªäººä¿¡æ¯")}catch(s){throw console.error("è·å–ç”¨æˆ·IDå¤±è´¥:",s),new Error("æ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·é‡æ–°ç™»å½•")}}return V(async()=>{const s=parseInt(g.params.id);if(isNaN(s)){console.error("âŒ æ— æ•ˆçš„ç»„ç»‡ID:",g.params.id),v.value=!1;return}try{if(console.log("ğŸ” åŠ è½½ç»„ç»‡è¯¦æƒ…ï¼Œç»„ç»‡ID:",s),r.value=await k.fetchOrganizationById(s),console.log("âœ… ç»„ç»‡ä¿¡æ¯åŠ è½½å®Œæˆ:",r.value),!r.value){console.error("âŒ ç»„ç»‡ä¸å­˜åœ¨ï¼ŒID:",s);return}const e=await f.fetchProjects(s);e.success?(u.value=f.projects,console.log("âœ… é¡¹ç›®åˆ—è¡¨åŠ è½½å®Œæˆï¼Œæ•°é‡:",u.value.length)):(console.error("âŒ åŠ è½½é¡¹ç›®åˆ—è¡¨å¤±è´¥:",e.error),u.value=[])}catch(e){console.error("âŒ åŠ è½½ç»„ç»‡è¯¦æƒ…å¤±è´¥:",e)}finally{v.value=!1}}),(s,e)=>{const S=M("RouterLink");return d(),i("div",q,[t("nav",G,[t("div",J,[t("div",K,[t("div",Q,[E(S,{to:"/organizations",class:"text-gray-600 hover:text-gray-900"},{default:N(()=>[...e[6]||(e[6]=[O(" â† è¿”å›ç»„ç»‡åˆ—è¡¨ ",-1)])]),_:1}),t("h1",W,o(r.value?.name),1)]),t("div",X,[t("button",{onClick:e[0]||(e[0]=a=>p.value=!0),class:"btn btn-primary"}," åˆ›å»ºé¡¹ç›® ")])])])]),t("main",Y,[t("div",Z,[t("div",tt,[e[15]||(e[15]=t("h2",{class:"text-lg font-semibold mb-4"},"ç»„ç»‡ä¿¡æ¯",-1)),t("div",et,[t("div",null,[e[10]||(e[10]=t("h3",{class:"text-md font-medium text-gray-900 mb-2"},"åŸºæœ¬ä¿¡æ¯",-1)),t("div",st,[t("div",null,[e[7]||(e[7]=t("span",{class:"text-sm text-gray-500"},"ç»„ç»‡åç§°:",-1)),t("p",at,o(r.value?.name||"æœªè®¾ç½®"),1)]),t("div",null,[e[8]||(e[8]=t("span",{class:"text-sm text-gray-500"},"ç»„ç»‡æè¿°:",-1)),t("p",ot,o(r.value?.description||"æš‚æ— æè¿°"),1)]),t("div",null,[e[9]||(e[9]=t("span",{class:"text-sm text-gray-500"},"ç»„ç»‡çŠ¶æ€:",-1)),t("p",nt,o(r.value?.is_active?"æ´»è·ƒ":"å·²åœç”¨"),1)])])]),t("div",null,[e[14]||(e[14]=t("h3",{class:"text-md font-medium text-gray-900 mb-2"},"æ—¶é—´ä¿¡æ¯",-1)),t("div",rt,[t("div",null,[e[11]||(e[11]=t("span",{class:"text-sm text-gray-500"},"åˆ›å»ºæ—¶é—´:",-1)),t("p",lt,o(r.value?.created_at?y(r.value.created_at):"æœªè®¾ç½®"),1)]),t("div",null,[e[12]||(e[12]=t("span",{class:"text-sm text-gray-500"},"æ›´æ–°æ—¶é—´:",-1)),t("p",it,o(r.value?.updated_at?y(r.value.updated_at):"æœªè®¾ç½®"),1)]),t("div",null,[e[13]||(e[13]=t("span",{class:"text-sm text-gray-500"},"é¡¹ç›®æ•°é‡:",-1)),t("p",dt,o(u.value.length)+" ä¸ª",1)])])])])]),t("div",null,[e[20]||(e[20]=t("h2",{class:"text-lg font-semibold mb-4"},"é¡¹ç›®åˆ—è¡¨",-1)),!v.value&&u.value.length>0?(d(),i("div",ut,[(d(!0),i(P,null,$(u.value,a=>(d(),i("div",{key:a.id,class:"card p-6 hover:shadow-md transition-shadow cursor-pointer",onClick:Dt=>s.$router.push(`/projects/${a.id}`)},[t("h3",ct,o(a.name),1),t("p",pt,o(a.description||"æš‚æ— æè¿°"),1),t("div",vt,[t("span",{class:T([C(a.status),"px-2 py-1 rounded-full text-xs"])},o(z(a.status)),3),t("span",xt,o(y(a.created_at)),1)])],8,mt))),128))])):v.value?(d(),i("div",yt,[...e[19]||(e[19]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"},null,-1),t("p",{class:"mt-2 text-sm text-gray-600"},"åŠ è½½ä¸­...",-1)])])):(d(),i("div",gt,[e[16]||(e[16]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e[17]||(e[17]=t("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"æš‚æ— é¡¹ç›®",-1)),e[18]||(e[18]=t("p",{class:"mt-1 text-sm text-gray-500"},"åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªé¡¹ç›®å¼€å§‹å·¥ä½œ",-1)),t("div",ft,[t("button",{onClick:e[1]||(e[1]=a=>p.value=!0),class:"btn btn-primary"}," åˆ›å»ºé¡¹ç›® ")])]))])])]),p.value?(d(),i("div",bt,[t("div",wt,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold mb-4"},"åˆ›å»ºæ–°é¡¹ç›®",-1)),t("form",{onSubmit:L(D,["prevent"])},[t("div",_t,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"é¡¹ç›®åç§°",-1)),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>l.name=a),type:"text",required:"",class:"input",placeholder:"è¯·è¾“å…¥é¡¹ç›®åç§°"},null,512),[[h,l.name]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"é¡¹ç›®æè¿°",-1)),b(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>l.description=a),class:"input resize-none",rows:"3",placeholder:"è¯·è¾“å…¥é¡¹ç›®æè¿°ï¼ˆå¯é€‰ï¼‰"},null,512),[[h,l.description]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"é¡¹ç›®çŠ¶æ€",-1)),b(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.status=a),class:"input"},[...e[23]||(e[23]=[t("option",{value:"planning"},"è§„åˆ’ä¸­",-1),t("option",{value:"active"},"æ´»è·ƒ",-1),t("option",{value:"completed"},"å·²å®Œæˆ",-1),t("option",{value:"cancelled"},"å·²å–æ¶ˆ",-1)])],512),[[R,l.status]])])]),m.value?(d(),i("div",ht,o(m.value),1)):_("",!0),t("div",kt,[t("button",{type:"button",onClick:e[5]||(e[5]=a=>p.value=!1),class:"btn btn-secondary"}," å–æ¶ˆ "),t("button",{type:"submit",disabled:x.value,class:"btn btn-primary"},o(x.value?"åˆ›å»ºä¸­...":"åˆ›å»º"),9,Ct)])],32)])])):_("",!0)])}}});export{jt as default};
