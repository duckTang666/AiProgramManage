import{U as P,d as U,T as N,C as q,_ as E}from"./index-DAXvTnSp.js";import{a as R,r as m,k as F,b as r,f as e,l as k,y as z,p as G,z as v,n as y,e as p,t as a,F as f,h,o as l}from"./vue-CUAfhYnW.js";import"./supabase-DiqIXwZt.js";const J={class:"min-h-screen bg-gray-50"},W={class:"bg-white shadow-sm border-b border-gray-200"},$={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},K={class:"flex justify-between h-16"},Q={class:"flex items-center space-x-8"},X={class:"hidden md:flex items-center space-x-4"},Y={class:"flex items-center space-x-4"},Z=["disabled"],ee={class:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8"},te={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},se={class:"card p-6"},oe={class:"flex items-center"},ae={class:"text-2xl font-bold text-gray-900"},re={class:"card p-6"},le={class:"flex items-center"},ne={class:"text-2xl font-bold text-gray-900"},ie={class:"card p-6"},de={class:"flex items-center"},ce={class:"text-2xl font-bold text-gray-900"},ue={class:"card p-6"},ge={class:"flex items-center"},me={class:"text-2xl font-bold text-gray-900"},xe={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},ve={class:"card p-6"},pe={class:"flex justify-between items-center mb-6"},_e={class:"text-sm text-gray-500"},ye={class:"space-y-3"},fe=["src"],he={class:"flex-1"},be={class:"font-medium text-gray-900"},we={class:"text-sm text-gray-600"},ke={key:0,class:"text-center py-4 text-gray-500"},ze={class:"card p-6"},Ce={class:"flex justify-between items-center mb-6"},De={class:"text-sm text-gray-500"},Ie={class:"space-y-3"},je={class:"flex justify-between items-start mb-2"},Me={class:"font-medium text-gray-900"},He={class:"text-sm text-gray-600 mb-2"},Le={class:"flex justify-between items-center text-xs text-gray-500"},Ve={key:0,class:"text-center py-4 text-gray-500"},Be={class:"card p-6"},Se={class:"flex justify-between items-center mb-6"},Te={class:"text-sm text-gray-500"},Ae={class:"space-y-3"},Oe={class:"flex justify-between items-start mb-2"},Pe={class:"font-medium text-gray-900"},Ue={class:"text-sm text-gray-600 mb-2"},Ne={class:"flex justify-between items-center text-xs text-gray-500"},qe={key:0,class:"text-center py-4 text-gray-500"},Ee={class:"card p-6"},Re={class:"flex justify-between items-center mb-6"},Fe={class:"text-sm text-gray-500"},Ge={class:"space-y-3"},Je={class:"flex justify-between items-center mb-2"},We={class:"text-sm font-medium text-gray-700"},$e={class:"text-xs text-gray-500"},Ke={class:"text-sm text-gray-600 mb-1"},Qe={class:"text-sm text-gray-700"},Xe={key:0,class:"text-center py-4 text-gray-500"},Ye={key:0,class:"fixed inset-0 bg-white bg-opacity-80 flex items-center justify-center z-50"},Ze={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4 mt-6"},et={class:"flex items-center"},tt={class:"text-red-700"},st=R({__name:"DataDisplay",setup(ot){const c=m([]),u=m([]),g=m([]),x=m([]),n=m({users:0,organizations:0,projects:0,tasks:0}),_=m(!0),d=m(""),C=s=>s?new Date(s).toLocaleDateString("zh-CN"):"æœªè®¾ç½®";async function j(){await b()}async function M(){d.value="",await b()}async function H(){try{const s=await P.getUsers();c.value=s||[],n.value.users=c.value.length}catch(s){console.error("åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",s),c.value=[]}}async function L(){try{const s=await U.getProjects(1);u.value=s||[],n.value.projects=u.value.length}catch(s){console.error("åŠ è½½é¡¹ç›®æ•°æ®å¤±è´¥:",s),u.value=[]}}async function V(){try{const s=await N.getTasks(1);g.value=s||[],n.value.tasks=g.value.length}catch(s){console.error("åŠ è½½ä»»åŠ¡æ•°æ®å¤±è´¥:",s),g.value=[]}}async function B(){try{const s=await q.getChatHistory(1);x.value=s||[]}catch(s){console.error("åŠ è½½AIå¯¹è¯è®°å½•å¤±è´¥:",s),x.value=[]}}async function S(){try{const s=authStore.user?.email;if(!s)return console.log("ç”¨æˆ·é‚®ç®±ä¸ºç©ºï¼Œæ— æ³•æŸ¥è¯¢æ•°æ®åº“ç”¨æˆ·ID"),null;console.log("ğŸ” å¼€å§‹æŸ¥è¯¢æ•°æ®åº“ç”¨æˆ·IDï¼Œé‚®ç®±:",s);const{data:t,error:i}=await supabase.from("users").select("id").eq("email",s).single();return i?(console.error("æŸ¥è¯¢æ•°æ®åº“ç”¨æˆ·IDå¤±è´¥:",i),null):(console.log("âœ… è·å–åˆ°æ•°æ®åº“ç”¨æˆ·ID:",t.id),t.id)}catch(s){return console.error("è·å–æ•°æ®åº“ç”¨æˆ·IDå¤±è´¥:",s),null}}async function T(){try{const s=await S();if(!s){console.log("æ— æ³•è·å–æ•°æ®åº“ç”¨æˆ·IDï¼Œè·³è¿‡ç»„ç»‡æ•°æ®åŠ è½½"),n.value.organizations=0;return}const[{data:t,error:i},{data:o,error:D}]=await Promise.all([supabase.from("organization_members").select("organization_id").eq("user_id",s),supabase.from("organizations").select("id").eq("owner_id",s)]);if(i&&D){console.error("æŸ¥è¯¢ç»„ç»‡å…³ç³»å¤±è´¥:",i,D),n.value.organizations=0;return}const A=t?.map(w=>w.organization_id)||[],O=o?.map(w=>w.id)||[],I=[...new Set([...A,...O])];n.value.organizations=I.length,console.log("âœ… ç”¨æˆ·æ‰€å±ç»„ç»‡æ•°é‡:",I.length)}catch(s){console.error("åŠ è½½ç»„ç»‡æ•°æ®å¤±è´¥:",s),n.value.organizations=0}}async function b(){_.value=!0,d.value="";try{await Promise.all([H(),L(),V(),B(),T()]),console.log("ğŸ‰ æ•°æ®åŠ è½½å®Œæˆ:",{ç”¨æˆ·æ•°é‡:c.value.length,é¡¹ç›®æ•°é‡:u.value.length,ä»»åŠ¡æ•°é‡:g.value.length,å¯¹è¯è®°å½•:x.value.length})}catch(s){console.error("âŒ åŠ è½½æ•°æ®å¤±è´¥:",s),s?.code==="PGRST116"||s?.message?.includes("does not exist")?d.value="æ•°æ®åº“è¡¨ä¸å­˜åœ¨ï¼Œè¯·å…ˆæ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬":s?.message?.includes("JWT")?d.value="è®¤è¯ä»¤ç‰Œå¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•":s?.message?.includes("network")||s?.message?.includes("fetch")?d.value="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®":d.value=`æ•°æ®åŠ è½½å¤±è´¥: ${s.message}`}finally{_.value=!1}}return F(async()=>{await b()}),(s,t)=>{const i=G("RouterLink");return l(),r("div",J,[e("nav",W,[e("div",$,[e("div",K,[e("div",Q,[t[3]||(t[3]=e("h1",{class:"text-xl font-semibold text-gray-900"},"AIé¡¹ç›®ç®¡ç†å¹³å° - æ•°æ®å±•ç¤º",-1)),e("div",X,[k(i,{to:"/",class:"text-gray-700 hover:text-blue-600 font-medium"},{default:z(()=>[...t[0]||(t[0]=[v(" ä»ªè¡¨ç›˜ ",-1)])]),_:1}),k(i,{to:"/data-display",class:"text-blue-600 font-medium border-b-2 border-blue-600"},{default:z(()=>[...t[1]||(t[1]=[v(" æ•°æ®å±•ç¤º ",-1)])]),_:1}),k(i,{to:"/project-management",class:"text-gray-700 hover:text-blue-600 font-medium"},{default:z(()=>[...t[2]||(t[2]=[v(" é¡¹ç›®ç®¡ç† ",-1)])]),_:1})])]),e("div",Y,[e("button",{onClick:j,class:"btn btn-outline text-sm",disabled:_.value},[(l(),r("svg",{class:y(["w-4 h-4 mr-1",{"animate-spin":_.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[4]||(t[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),t[5]||(t[5]=v(" åˆ·æ–°æ•°æ® ",-1))],8,Z)])])])]),e("main",ee,[e("div",te,[e("div",se,[e("div",oe,[t[7]||(t[7]=e("div",{class:"p-3 rounded-full bg-blue-100 text-blue-600 mr-4"},[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})])],-1)),e("div",null,[t[6]||(t[6]=e("p",{class:"text-sm font-medium text-gray-600"},"ç”¨æˆ·æ€»æ•°",-1)),e("p",ae,a(n.value.users),1)])])]),e("div",re,[e("div",le,[t[9]||(t[9]=e("div",{class:"p-3 rounded-full bg-green-100 text-green-600 mr-4"},[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})])],-1)),e("div",null,[t[8]||(t[8]=e("p",{class:"text-sm font-medium text-gray-600"},"ç»„ç»‡æ€»æ•°",-1)),e("p",ne,a(n.value.organizations),1)])])]),e("div",ie,[e("div",de,[t[11]||(t[11]=e("div",{class:"p-3 rounded-full bg-purple-100 text-purple-600 mr-4"},[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"})])],-1)),e("div",null,[t[10]||(t[10]=e("p",{class:"text-sm font-medium text-gray-600"},"é¡¹ç›®æ€»æ•°",-1)),e("p",ce,a(n.value.projects),1)])])]),e("div",ue,[e("div",ge,[t[13]||(t[13]=e("div",{class:"p-3 rounded-full bg-orange-100 text-orange-600 mr-4"},[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})])],-1)),e("div",null,[t[12]||(t[12]=e("p",{class:"text-sm font-medium text-gray-600"},"ä»»åŠ¡æ€»æ•°",-1)),e("p",me,a(n.value.tasks),1)])])])]),e("div",xe,[e("div",ve,[e("div",pe,[t[14]||(t[14]=e("h3",{class:"text-lg font-semibold text-gray-900"},"ç”¨æˆ·åˆ—è¡¨",-1)),e("span",_e,a(c.value.length)+" ä¸ªç”¨æˆ·",1)]),e("div",ye,[(l(!0),r(f,null,h(c.value.slice(0,5),o=>(l(),r("div",{key:o.id,class:"flex items-center p-3 border border-gray-200 rounded-lg"},[e("img",{src:o.avatar_url||"/default-avatar.png",class:"w-10 h-10 rounded-full mr-3",alt:"ç”¨æˆ·å¤´åƒ"},null,8,fe),e("div",he,[e("p",be,a(o.display_name),1),e("p",we,a(o.email),1)]),e("span",{class:y(["px-2 py-1 rounded-full text-xs font-medium",o.role==="admin"?"bg-red-100 text-red-800":o.role==="manager"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"])},a(o.role==="admin"?"ç®¡ç†å‘˜":o.role==="manager"?"ç»ç†":"æˆå‘˜"),3)]))),128)),c.value.length===0?(l(),r("div",ke," æš‚æ— ç”¨æˆ·æ•°æ® ")):p("",!0)])]),e("div",ze,[e("div",Ce,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold text-gray-900"},"é¡¹ç›®åˆ—è¡¨",-1)),e("span",De,a(u.value.length)+" ä¸ªé¡¹ç›®",1)]),e("div",Ie,[(l(!0),r(f,null,h(u.value.slice(0,5),o=>(l(),r("div",{key:o.id,class:"p-3 border border-gray-200 rounded-lg"},[e("div",je,[e("h4",Me,a(o.name),1),e("span",{class:y(["px-2 py-1 rounded-full text-xs font-medium",o.status==="active"?"bg-green-100 text-green-800":o.status==="completed"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"])},a(o.status==="active"?"è¿›è¡Œä¸­":o.status==="completed"?"å·²å®Œæˆ":"è§„åˆ’ä¸­"),3)]),e("p",He,a(o.description),1),e("div",Le,[e("span",null,"è¿›åº¦: "+a(o.progress_percentage||0)+"%",1),e("span",null,"ä¼˜å…ˆçº§: "+a(o.priority==="high"?"é«˜":o.priority==="urgent"?"ç´§æ€¥":"ä¸­"),1)])]))),128)),u.value.length===0?(l(),r("div",Ve," æš‚æ— é¡¹ç›®æ•°æ® ")):p("",!0)])]),e("div",Be,[e("div",Se,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold text-gray-900"},"ä»»åŠ¡åˆ—è¡¨",-1)),e("span",Te,a(g.value.length)+" ä¸ªä»»åŠ¡",1)]),e("div",Ae,[(l(!0),r(f,null,h(g.value.slice(0,5),o=>(l(),r("div",{key:o.id,class:"p-3 border border-gray-200 rounded-lg"},[e("div",Oe,[e("h4",Pe,a(o.title),1),e("span",{class:y(["px-2 py-1 rounded-full text-xs font-medium",o.status==="done"?"bg-green-100 text-green-800":o.status==="in_progress"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"])},a(o.status==="done"?"å·²å®Œæˆ":o.status==="in_progress"?"è¿›è¡Œä¸­":"å¾…åŠ"),3)]),e("p",Ue,a(o.description),1),e("div",Ne,[e("span",null,"æˆªæ­¢: "+a(C(o.due_date)),1),e("span",null,"é¢„ä¼°: "+a(o.estimated_hours||0)+"å°æ—¶",1)])]))),128)),g.value.length===0?(l(),r("div",qe," æš‚æ— ä»»åŠ¡æ•°æ® ")):p("",!0)])]),e("div",Ee,[e("div",Re,[t[17]||(t[17]=e("h3",{class:"text-lg font-semibold text-gray-900"},"AIå¯¹è¯è®°å½•",-1)),e("span",Fe,a(x.value.length)+" æ¡è®°å½•",1)]),e("div",Ge,[(l(!0),r(f,null,h(x.value.slice(0,5),o=>(l(),r("div",{key:o.id,class:"p-3 border border-gray-200 rounded-lg"},[e("div",Je,[e("span",We,a(o.message_type==="question"?"é—®é¢˜":o.message_type==="suggestion"?"å»ºè®®":"åˆ†æ"),1),e("span",$e,a(C(o.created_at)),1)]),e("p",Ke,[t[18]||(t[18]=e("strong",null,"ç”¨æˆ·:",-1)),v(" "+a(o.user_message),1)]),e("p",Qe,[t[19]||(t[19]=e("strong",null,"AI:",-1)),v(" "+a(o.ai_response),1)])]))),128)),x.value.length===0?(l(),r("div",Xe," æš‚æ— å¯¹è¯è®°å½• ")):p("",!0)])])]),_.value?(l(),r("div",Ye,[...t[20]||(t[20]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e("p",{class:"text-gray-600"},"æ­£åœ¨åŠ è½½æ•°æ®...")],-1)])])):p("",!0),d.value?(l(),r("div",Ze,[e("div",et,[t[21]||(t[21]=e("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),e("span",tt,a(d.value),1),e("button",{onClick:M,class:"ml-4 text-sm bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded"}," é‡è¯• ")])])):p("",!0)])])}}}),nt=E(st,[["__scopeId","data-v-8f768725"]]);export{nt as default};
