import{s as x,_ as k}from"./index-C9ZF52Z0.js";import{a as S,r as d,c as I,k as j,b as c,f as e,g as z,t as n,n as m,z as C,F as y,h,o as l}from"./vue-8aMp4Igu.js";import"./supabase-DiqIXwZt.js";const T={class:"min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8"},J={class:"max-w-4xl mx-auto"},N={class:"bg-white rounded-lg shadow-md p-6 mb-6"},B={class:"space-y-3"},E={class:"flex items-center justify-between"},M={class:"font-mono text-sm"},R={class:"flex items-center justify-between"},V={class:"font-mono text-sm"},D={class:"flex items-center justify-between"},F={class:"flex gap-4 mb-6"},U=["disabled"],L={key:0},Q={key:1,class:"flex items-center"},q={class:"bg-white rounded-lg shadow-md p-6 mb-6"},A={class:"space-y-3"},G={class:"font-medium"},K={class:"text-sm text-gray-600"},O={class:"bg-white rounded-lg shadow-md p-6"},P={class:"space-y-4"},X={class:"flex items-center"},Y={class:"font-mono bg-gray-100 px-2 py-1 rounded text-sm mr-3"},Z={class:"text-sm text-gray-600"},H=S({__name:"DatabaseTest",setup($){const p=d(!1),r=d("idle"),i=d("未测试"),g=d([]),v=d([{name:"users",description:"用户表",status:"checking"},{name:"organizations",description:"组织表",status:"checking"},{name:"organization_members",description:"组织成员表",status:"checking"},{name:"projects",description:"项目表",status:"checking"},{name:"project_members",description:"项目成员表",status:"checking"},{name:"tasks",description:"任务表",status:"checking"},{name:"chat_history",description:"AI对话历史表",status:"checking"},{name:"notifications",description:"通知表",status:"checking"}]),b=d({supabaseUrl:"https://pgnjxsvtxrqsuukadlzu.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnbmp4c3Z0eHJxc3V1a2FkbHp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2MTQ5NjYsImV4cCI6MjA3NzE5MDk2Nn0.kw0yn1Wnn4GzkXbPYRUcTjyQr6esb-BED5h-OdFiEMI"}),_=I(()=>{switch(r.value){case"success":return"text-green-600 font-medium";case"error":return"text-red-600 font-medium";default:return"text-gray-600"}});function o(a,s,t){g.value.push({type:a,title:s,message:t})}async function w(){p.value=!0,g.value=[],r.value="idle",i.value="测试中...";try{if(!b.value.supabaseUrl||!b.value.supabaseKey){o("error","环境变量配置","Supabase配置不完整"),r.value="error",i.value="配置错误";return}o("success","环境变量","Supabase配置检查通过");const{data:a,error:s}=await x.auth.getSession();s?o("warning","认证连接",`认证连接测试失败: ${s.message}`):o("success","认证连接","Supabase认证连接正常");const{data:t,error:u}=await x.from("organizations").select("count").limit(1);u?u.code==="PGRST116"?(o("warning","数据库连接","数据库连接正常，但表可能不存在"),r.value="success",i.value="连接正常（表未创建）"):(o("error","数据库连接",`数据库连接失败: ${u.message}`),r.value="error",i.value="连接失败"):(o("success","数据库连接","数据库连接正常"),r.value="success",i.value="连接正常"),await f()}catch(a){o("error","连接测试",`测试过程中发生错误: ${a.message}`),r.value="error",i.value="测试失败"}finally{p.value=!1}}async function f(){for(const a of v.value)try{const{error:s}=await x.from(a.name).select("count").limit(1);s?(s.code,a.status="missing"):a.status="exists"}catch{a.status="missing"}}return j(()=>{f()}),(a,s)=>(l(),c("div",T,[e("div",J,[s[8]||(s[8]=e("div",{class:"text-center mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"Supabase数据库连接测试"),e("p",{class:"text-gray-600"},"验证数据库连接状态和表结构")],-1)),e("div",N,[s[3]||(s[3]=e("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"配置信息",-1)),e("div",B,[e("div",E,[s[0]||(s[0]=e("span",{class:"text-gray-600"},"Supabase URL:",-1)),e("span",M,n(b.value.supabaseUrl?"已配置":"未配置"),1)]),e("div",R,[s[1]||(s[1]=e("span",{class:"text-gray-600"},"API Key:",-1)),e("span",V,n(b.value.supabaseKey?"已配置":"未配置"),1)]),e("div",D,[s[2]||(s[2]=e("span",{class:"text-gray-600"},"连接状态:",-1)),e("span",{class:m(_.value)},n(i.value),3)])])]),e("div",F,[e("button",{onClick:w,disabled:p.value,class:"btn btn-primary flex-1"},[p.value?(l(),c("span",Q,[...s[4]||(s[4]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),C(" 测试中... ",-1)])])):(l(),c("span",L,"测试数据库连接"))],8,U),s[5]||(s[5]=e("a",{href:"https://supabase.com/dashboard/project/pgnjxsvtxrqsuukadlzu",target:"_blank",class:"btn btn-outline"}," 打开Supabase控制台 ",-1))]),e("div",q,[s[6]||(s[6]=e("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"测试结果",-1)),e("div",A,[(l(!0),c(y,null,h(g.value,(t,u)=>(l(),c("div",{key:u,class:m(["flex items-center p-3 rounded-lg",{"bg-green-50 border border-green-200":t.type==="success","bg-yellow-50 border border-yellow-200":t.type==="warning","bg-red-50 border border-red-200":t.type==="error"}])},[e("span",{class:m(["w-6 h-6 rounded-full flex items-center justify-center mr-3 text-white text-sm",{"bg-green-500":t.type==="success","bg-yellow-500":t.type==="warning","bg-red-500":t.type==="error"}])},n(t.type==="success"?"✓":t.type==="warning"?"!":"✗"),3),e("div",null,[e("p",G,n(t.title),1),e("p",K,n(t.message),1)])],2))),128))])]),e("div",O,[s[7]||(s[7]=e("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"数据库表状态",-1)),e("div",P,[(l(!0),c(y,null,h(v.value,t=>(l(),c("div",{key:t.name,class:m(["flex items-center justify-between p-3 border rounded-lg",{"border-green-200 bg-green-50":t.status==="exists","border-yellow-200 bg-yellow-50":t.status==="checking","border-red-200 bg-red-50":t.status==="missing"}])},[e("div",X,[e("span",Y,n(t.name),1),e("span",Z,n(t.description),1)]),e("span",{class:m(["px-2 py-1 rounded text-xs font-medium",{"bg-green-100 text-green-800":t.status==="exists","bg-yellow-100 text-yellow-800":t.status==="checking","bg-red-100 text-red-800":t.status==="missing"}])},n(t.status==="exists"?"已存在":t.status==="checking"?"检查中":"未创建"),3)],2))),128))])]),s[9]||(s[9]=z('<div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6" data-v-7e072c57><h3 class="text-lg font-semibold text-blue-800 mb-3" data-v-7e072c57>操作指南</h3><div class="space-y-4" data-v-7e072c57><div class="flex items-start" data-v-7e072c57><span class="bg-blue-100 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 mt-1" data-v-7e072c57>1</span><div data-v-7e072c57><p class="font-medium" data-v-7e072c57>在Supabase控制台中执行SQL脚本</p><p class="text-sm text-gray-600" data-v-7e072c57>复制 <code class="bg-gray-100 px-1 rounded" data-v-7e072c57>supabase-init.sql</code> 文件内容到SQL编辑器中执行</p></div></div><div class="flex items-start" data-v-7e072c57><span class="bg-blue-100 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 mt-1" data-v-7e072c57>2</span><div data-v-7e072c57><p class="font-medium" data-v-7e072c57>插入模拟数据</p><p class="text-sm text-gray-600" data-v-7e072c57>执行 <code class="bg-gray-100 px-1 rounded" data-v-7e072c57>supabase-mock-data.sql</code> 文件内容</p></div></div><div class="flex items-start" data-v-7e072c57><span class="bg-blue-100 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 mt-1" data-v-7e072c57>3</span><div data-v-7e072c57><p class="font-medium" data-v-7e072c57>测试登录功能</p><p class="text-sm text-gray-600" data-v-7e072c57>使用测试账号进行登录测试：admin@aipm.com / 任意密码</p></div></div></div></div>',1))])]))}}),te=k(H,[["__scopeId","data-v-7e072c57"]]);export{te as default};
